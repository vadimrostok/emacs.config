function signIn(email, pass) {
	$.getJSON("/signin", {
		email: email, pass: pass
	}, function(data) {
		if (data.code === 0) {
			location.href = "/";
		} else {
			$(".sign-in .err").text(data.error).show();
		}
	});
}


$(function() {

	$(".sign-in").click(function () {
		if ($(this).hasClass("opened")) {
			$(".sign-in-box").animate({opacity: "0"}, 200);
			$(this).removeClass("opened");
		} else {
			$(this).addClass("opened").animate({width: 160, height: 104}, 300, function () {
				$(".sign-in__fields").animate({opacity: "show"}, 200);
			});
		}
	});
	$(".sign-in .ok").click(function() {
		var email = $(".sign-in .email").val();
		var pass = $(".sign-in .pass").val();
		signIn(email, pass);
	});
	$(".sign-in .pass").keyup(function(e) {
		if (e.keyCode == 13) $(".sign-in .ok").trigger("click");
	});


	$("#register .pass2").keyup(function(e) {
		if (e.keyCode == 13) $("#register .ok").trigger("click");
	});


	$("#register .ok").click(function() {
		var email = $("#register .email").val();
		var pass = $("#register .pass").val();
		var pass2 = $("#register .pass2").val();
		if (pass !== pass2) {
			$("#register .err").text("passwords are not the same").show();
			return;
		}
		$.getJSON("/register", {
			email: email, pass: pass
		}, function(data) {
			if (data.code === 0) {
				signIn(email, pass);
			} else {
				$("#register .err").text(data.error).show();
			}
		});
	});

});
